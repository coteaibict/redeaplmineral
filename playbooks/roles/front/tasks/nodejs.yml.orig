---
- name: Test | NPM is installed
  shell: npm -v
  register: npm_installed
  ignore_errors: true

<<<<<<< Updated upstream
- name: NodeJS | Prepare for installation
  raw: "curl -sL https://deb.nodesource.com/setup | sudo bash -"
  become: true
  when: npm_installed|failed
=======
- name: NodeJS | Download the nvm (node version manager) install script
  get_url: url=https://raw.githubusercontent.com/creationix/nvm/v0.33.1/install.sh dest=/tmp/install.sh

- name: Install dependencies
  apt: pkg={{ item }} update_cache=yes cache_valid_time=3600
  with_items:
    - git
    - curl
    - build-essential
    - libssl-dev
  become: yes

- name: NodeJS | Execute the nvm install script
  shell: bash install.sh chdir=/tmp executable=/bin/bash
>>>>>>> Stashed changes

- name: NodeJS | Install NodeJS
  apt: name=nodejs state=present
  become: true

<<<<<<< Updated upstream
- name: NodeJS | Install build-essentials package
  apt: name=build-essential state=present
  become: true
=======
- name: Install the specified node version using the nvm command and set it as default
  shell: . {{ home_dir }}/.nvm/nvm.sh && nvm install 7.4.0 && nvm run 7.4.0 --version && nvm alias default 7.4.0
      creates={{ home_dir }}/.nvm/versions/node/v7.4.0
  become: yes
>>>>>>> Stashed changes

- name: NodeJS | Install Grunt, Bower and Gulp
  command: npm install -g {{ item }}
  become: true
  with_items:
    - grunt
    - grunt-cli
    - bower
    - gulp
